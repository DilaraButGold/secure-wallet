// Bu dosya veritabanımızın haritasıdır.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. KULLANICI (Kimlik Bilgileri)
model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String    // Hashlenmiş şifre
  fullName  String
  createdAt DateTime  @default(now())
  
  // İlişkiler: Bir kullanıcının birden fazla hesabı olabilir
  accounts  Account[]
}

// 2. HESAP (Cüzdanlar)
// Örn: Ali'nin TRY hesabı, Ali'nin USD hesabı
model Account {
  id        Int      @id @default(autoincrement())
  type      String   @default("TRY") // TRY, USD, EUR
  balance   Decimal  @default(0.00)  // DİKKAT: Para için asla Float kullanma! Decimal kullan.
  
  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  // Bu hesabın yaptığı işlemler
  sentTransactions     Transaction[] @relation("SentTransactions")
  receivedTransactions Transaction[] @relation("ReceivedTransactions")

  // Aynı kullanıcının aynı türde sadece 1 hesabı olsun (Unique Constraint)
  @@unique([userId, type])
}

// 3. TRANSFER GEÇMİŞİ (Dekontlar)
model Transaction {
  id        Int      @id @default(autoincrement())
  amount    Decimal
  type      String   // DEPOSIT (Yatırma), WITHDRAW (Çekme), TRANSFER (Transfer)
  status    String   @default("PENDING") // PENDING, COMPLETED, FAILED
  
  // Gönderen Hesap (Opsiyonel: Para yatırma işleminde gönderen yoktur)
  fromAccountId Int?
  fromAccount   Account? @relation("SentTransactions", fields: [fromAccountId], references: [id])

  // Alan Hesap (Opsiyonel: Para çekme işleminde alan yoktur)
  toAccountId   Int?
  toAccount     Account? @relation("ReceivedTransactions", fields: [toAccountId], references: [id])

  createdAt DateTime @default(now())
}